<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.8"></script>

  <link rel="stylesheet" href="css/style.css">

  <title>Country Happiness Score Visualization </title>
  

</head>
<br>

<body class = "body">
  <div class = "container firstlayer"> 
    
    <h1 class="title"> Country Happiness Score Visualization </h1>
    <h3 class="author"> Student Name: Weiliang Chen </h3>
    <br>
    <br>
    <br>
    <h2 class = "subTitle">Happiness Score in Countries between 2007 - 2021</h2>
    <br>
    <br>
    <h3 class = "text"> The happiness score is a data used to measure the happiness rating baesd on residents' evaluation to their country, we 
    can estimate the countries' living standard. In the map graph below, we can see the scores of countries between 2007 - 2021. </h3>
    <br>
    <h3 class = "text"> From this map, we can see that now Finland is the most happy country which has the highest score
      from 2016 to 2021. Complete public services, low levels of crime and corruption, beautiful nature, these factors make Finland take the first place in the world
      . Conversely, due to security situation, Afghanistan is the unhappiest country in the world, its happiness score only reach 2.5 in 2021.
    </h3>
    <br>
    <div class = "center1" id="vis1"> </div>

     <script>
    const spec = {
      
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1100,
  "height": 500,
  "projection": {"type": "equalEarth", "rotate": [-150, 0, 0], "scale": {"expr": "zoom_level"}, "center": {"expr": "center_to"}},
  "params": [
    {
      "name": "year_selection",
      "value": 2021,
      "bind": {
        "input": "range",
        "min": 2007,
        "max": 2021,
        "step": 1,
        "name": "Year selection"
      }
    },
    {
      "name": "zoom_level",
      "value": 200,
      "bind": {
      "input": "range",
      "min": 200,
      "max": 500,
      "step": 10,
      "name": "Zoom: "
      }
    },
    {
      "name": "center_to",
      "bind": {
      "input": "select",
      "options": [
        [0, 0],
        [110, 47.11],
        [150, -20.53],
        [-120, 45],
        [-120, 0],
        [-40, 20],
        [-10,-25]
      ],
      "labels": [
        "None",
        "North America",
        "South America",
        "Europe",
        "Africa",
        "Asia",
        "Oceania"],
      "name": "Map Focus: "
      }
    }  
  ],
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
        "format": {"type": "topojson", "feature": "oceans"}
      },
      "mark": {"type": "geoshape", "fill": "skyblue"}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/weiliang-chen/FIT3179/main/ne_110m.json",
        "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
      },
      "mark": {
        "type": "geoshape",
        "fill": null,
        "stroke": "lightgoldenrodyellow"
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/weiliang-chen/FIT3179/main/ne_110m.json",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "transform": [
        {
          "calculate": "'Data is not available in ' + datum.properties.NAME",
          "as": "note"
        }
      ],
      "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"},
      "encoding": {"tooltip": {"field": "note"}}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/weiliang-chen/FIT3179/main/data/world-happiness-report.csv"
      },
      "transform": [
        {
          "lookup": "Country",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/weiliang-chen/FIT3179/main/ne_110m.json",
              "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "key": "properties.NAME"
          },
          "as": "geo"
        },
        {"filter": "datum.year == year_selection"},
        {"calculate": "datum.Score", "as": "Score"}
      ],
      "mark": {"type": "geoshape", "stroke": "white"},
      "encoding": {
        "shape": {
          "field": "geo",
          "type": "geojson"
        },
        "color": {
          "field": "Score",
          "type": "quantitative",
          "scale": {
            "type": "linear",
            "domain": [ 3,4, 5, 6, 7]
          }
        },
        
        "tooltip": [
          {"field": "Country", "type": "nominal", "title": "Country"},
          {"field": "Score", "type": "quantitative"},
          {"field": "year", "type": "quantitative"}
        ],
      }
    },
  ],
  "config": {
    "legend": {
        "labelFontSize": 12
      }
  }
  };
  vegaEmbed("#vis1", spec, {mode: "vega-lite"}).then(console.log).catch(console.warn);
    </script>
  <br>
  <br>
  <br>
  <h2 class="subTitle">Country Happiness score and affect factors Comparison</h2>
  <br>
  <br>
  <h3 class = "text"> The happiness score can be evaluated based on muliple factors. In the charts below, you can see the relationship
    between happiness and the factors which affects the former. </h3>
  <br>
  <h3 class = "text">
    From the bubble chart, we can clearly see that happiness score is positively correlated with healthy life 
    expectency, Social support, GDP per capital and freedom, negatively correlated with corruption. In happiness Score
    and Generosity bubble chart, the data is scattered and it doesn't look like they are related. It might because
    generosity is relatively subjective factors, and it is hard to be measured by objective facts.
  </h3>
  <br>
  <div class="center", id="vis2">  </div>
    <script>
      const spec1 = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": 
    {
        "url": "https://raw.githubusercontent.com/weiliang-chen/FIT3179/main/data/world-happiness-report.csv"  
    },
    "params": [
        {
          "name": "year_selection",
          "value": 2021,
          "bind": {
            "input": "range",
            "min": 2007,
            "max": 2021,
            "step": 1,
            "name": "Year selection"
          }
        },
        {
            "name": "Continent_selection",
            "bind": {
            "input": "select",
            "options": [
                null,
                "North America",
                "South America",
                "Europe",
                "Africa",
                "Asia",
                "Oceania"
            ],
            "labels":[
                "Show All",
                "North America",
                "South America",
                "Europe",
                "Africa",
                "Asia",
                "Oceania"
            ],
            "name": "Region Selection: "
            }
        },
        {
            "name": "Population_Above",
            "value": 0,
            "bind": {
            "input": "range",
            "min": 0,
            "max": 100000000,
            "step": 1000000,
            "name": "Minimum Population: "
            }
        }    
      ],
      "vconcat":[
        {
            "hconcat": [
                {
                    "title": "Happiness Score and healthy life expectency",
                    "width": 400,
                    "height": 400,
                    "transform": [
                        {"filter": "datum.year == year_selection"},
                        {"filter": "datum.Healthy > 35"},
                        {"filter": "Continent_selection == null || datum.Region == Continent_selection"},
                        {"filter": "datum.Population > Population_Above"}   
                    ],
                    "encoding": {
                        "x": {
                            "field": "Healthy",
                            "type": "quantitative",
                            "title": "Healthy life expectancy",
                            "scale": {"type": "linear", "domain": [35, 80]}
                        },
                        "y": {
                            "field": "Score",
                            "type": "quantitative",
                            "scale": {"type": "linear", "domain": [2, 8]}
                        }
                    },
                    "layer":[
                        {
                            "mark": "circle",
                            "encoding": {
                                "color": {
                                    "field": "Region",
                                    "type": "nominal",
                                    "scale": {
                                        "domain": [
                                            "North America",
                                            "South America",
                                            "Europe",
                                            "Africa",
                                            "Asia",
                                            "Oceania"
                                            ],
                                        "range": [
                                            "#e41a1c",
                                            "#984ea3",
                                            "#ff7f00",
                                            "#93f5cb",
                                            "#377eb8",
                                            "#a65628"
                                            ]
                                        }
                                },
                                "size": {
                                    "field": "Population",
                                    "type": "quantitative",
                                    "scale": {
                                        "type": "threshold",
                                        "domain": [1000000, 10000000, 50000000, 100000000, 500000000, 1000000000],
                                        "range": [50, 100, 200, 300, 400, 1000, 2000]
                                    }
                                },
                          
                                "tooltip": [
                                    {"field": "Country", "type": "nominal", "title": "Country"},
                                    {"field": "Region", "type": "nominal"},
                                    {"field": "Score", "type": "quantitative"},
                                    {"field": "Healthy", "type": "quantitative"},
                                    {"field": "Population", "type": "quantitative", "title":"Population in 2020","format": ".1s"}
                                ]
                            },
                            
                        }
                    ],
                },
                {
                    "width": 400,
                    "height": 400,
                    "title": "Happiness Score and Social support",
                    "transform": [
                        {"filter": "datum.year == year_selection"},
                        {"filter": "Continent_selection == null || datum.Region == Continent_selection"},
                        {"filter": "datum.Social_support > 0.25"},
                        {"filter": "datum.Population > Population_Above"}   
                    ],
                    "encoding": {
                        "x": {
                            "field": "Social_support",
                            "type": "quantitative",
                            "title": "Social support",
                            "scale": {"type": "linear", "domain": [0.25, 1.00]}
                        },
                        "y": {
                            "field": "Score",
                            "type": "quantitative",
                            "scale": {"type": "linear", "domain": [2, 8]}
                        }
                    },
                    "layer":[
                        {
                            "mark": "circle",
                            "encoding": {
                                "color": {
                                    "field": "Region",
                                    "type": "nominal",
                                    "scale": {
                                        "domain": [
                                            "North America",
                                            "South America",
                                            "Europe",
                                            "Africa",
                                            "Asia",
                                            "Oceania"
                                            ],
                                        "range": [
                                            "#e41a1c",
                                            "#984ea3",
                                            "#ff7f00",
                                            "#93f5cb",
                                            "#377eb8",
                                            "#a65628"
                                            ]
                                        }
                                },
                                "size": {
                                    "field": "Population",
                                    "type": "quantitative",
                                    "scale": {
                                        "type": "threshold",
                                        "domain": [1000000, 10000000, 50000000, 100000000, 500000000, 1000000000],
                                        "range": [50, 100, 200, 300, 400, 1000, 2000]
                                    },
                                    "legend": {"format": ".1s"}
                                },  
                                "tooltip": [
                                    {"field": "Country", "type": "nominal", "title": "Country"},
                                    {"field": "Region", "type": "nominal"},
                                    {"field": "Score", "type": "quantitative"},
                                    {"field": "Social_support", "type": "quantitative"},
                                    {"field": "Population", "type": "quantitative", "title":"Population in 2020","format": ".1s"}
                                  ]
                            }
                        }
                    ]
                  }
              ]            
        },
        {
            "hconcat": [
                {
                    "width": 400,
                    "height": 400,
                    "title": "Happiness Score and GPD per capita",
                    "transform": [
                        {"filter": "datum.year == year_selection"},
                        {"filter": "datum.GDP_per_capita > 0"},
                        {"filter": "Continent_selection == null || datum.Region == Continent_selection"},
                        {"filter": "datum.Population > Population_Above"}   
                    ],
                    "encoding": {
                        "x": {
                            "field": "GDP_per_capita",
                            "type": "quantitative",
                            "title": "GDP(log)",
                            "scale": {"type": "linear", "domain": [6, 12]}
                        },
                        "y": {
                            "field": "Score",
                            "type": "quantitative",
                            "scale": {"type": "linear", "domain": [2, 8]}
                        }
                    },
                    "layer":[
                        {
                            "mark": "circle",
                            "encoding": {
                                "color": {
                                    "field": "Region",
                                    "type": "nominal",
                                    "scale": {
                                        "domain": [
                                            "North America",
                                            "South America",
                                            "Europe",
                                            "Africa",
                                            "Asia",
                                            "Oceania"
                                            ],
                                        "range": [
                                            "#e41a1c",
                                            "#984ea3",
                                            "#ff7f00",
                                            "#93f5cb",
                                            "#377eb8",
                                            "#a65628"
                                            ]
                                        }
                                },
                                "size": {
                                    "field": "Population",
                                    "type": "quantitative",
                                    "scale": {
                                        "type": "threshold",
                                        "domain": [1000000, 10000000, 50000000, 100000000, 500000000, 1000000000],
                                        "range": [50, 100, 200, 300, 400, 1000, 2000]
                                    },
                                    "legend": {"format": ".1s"}
                                },  
                                "tooltip": [
                                    {"field": "Country", "type": "nominal", "title": "Country"},
                                    {"field": "Region", "type": "nominal"},
                                    {"field": "Score", "type": "quantitative"},
                                    {"field": "GDP_per_capita", "type": "quantitative"},
                                    {"field": "Population", "type": "quantitative", "title":"Population in 2020","format": ".1s"}
                                  ]
                            }
                        }
                    ]
                },
                {
                    "width": 400,
                    "height": 400,
                    "title": "Happiness Score and Freedom",
                    "transform": [
                        {"filter": "datum.year == year_selection"},
                        {"filter": "Continent_selection == null || datum.Region == Continent_selection"},
                        {"filter": "datum.Freedom > 0"},
                        {"filter": "datum.Population > Population_Above"}   
                    ],
                    "encoding": {
                        "x": {
                            "field": "Freedom",
                            "type": "quantitative",
                            "title": "Social support",
                            "scale": {"type": "linear", "domain": [0.25, 1.00]}
                        },
                        "y": {
                            "field": "Score",
                            "type": "quantitative",
                            "scale": {"type": "linear", "domain": [2, 8]}
                        }
                    },
                    "layer":[
                        {
                            "mark": "circle",
                            "encoding": {
                                "color": {
                                    "field": "Region",
                                    "type": "nominal",
                                    "scale": {
                                        "domain": [
                                            "North America",
                                            "South America",
                                            "Europe",
                                            "Africa",
                                            "Asia",
                                            "Oceania"
                                            ],
                                        "range": [
                                            "#e41a1c",
                                            "#984ea3",
                                            "#ff7f00",
                                            "#93f5cb",
                                            "#377eb8",
                                            "#a65628"
                                            ]
                                        }
                                },
                                "size": {
                                    "field": "Population",
                                    "type": "quantitative",
                                    "scale": {
                                        "type": "threshold",
                                        "domain": [1000000, 10000000, 50000000, 100000000, 500000000, 1000000000],
                                        "range": [50, 100, 200, 300, 400, 1000, 2000]
                                    },
                                    "legend": {"format": ".1s"}
                                },  
                                "tooltip": [
                                    {"field": "Country", "type": "nominal", "title": "Country"},
                                    {"field": "Region", "type": "nominal"},
                                    {"field": "Score", "type": "quantitative"},
                                    {"field": "Freedom", "type": "quantitative"},
                                    {"field": "Population", "type": "quantitative", "title":"Population in 2020","format": ".1s"}
                                  ]
                            }
                        }
                    ]
                }
              ]
        },
        {
            "hconcat": [
                {
                    "width": 400,
                    "height": 400,
                    "title": "Happiness Score and Generosity",
                    "transform": [
                        {"filter": "datum.year == year_selection"},
                        {"filter": "Continent_selection == null || datum.Region == Continent_selection"},
                        {"filter": "datum.Population > Population_Above"}   
                    ],
                    "encoding": {
                        "x": {
                            "field": "Generosity",
                            "type": "quantitative",
                            "title": "Generosity",
                            "scale": {"type": "linear", "domain": [-0.3, 0.8]}
                        },
                        "y": {
                            "field": "Score",
                            "type": "quantitative",
                            "scale": {"type": "linear", "domain": [2, 8]}
                        }
                    },
                    "layer":[
                        {
                            "mark": "circle",
                            "encoding": {
                                "color": {
                                    "field": "Region",
                                    "type": "nominal",
                                    "scale": {
                                        "domain": [
                                            "North America",
                                            "South America",
                                            "Europe",
                                            "Africa",
                                            "Asia",
                                            "Oceania"
                                            ],
                                        "range": [
                                            "#e41a1c",
                                            "#984ea3",
                                            "#ff7f00",
                                            "#93f5cb",
                                            "#377eb8",
                                            "#a65628"
                                            ]
                                        }
                                },
                                "size": {
                                    "field": "Population",
                                    "type": "quantitative",
                                    "scale": {
                                        "type": "threshold",
                                        "domain": [1000000, 10000000, 50000000, 100000000, 500000000, 1000000000],
                                        "range": [50, 100, 200, 300, 400, 1000, 2000]
                                    },
                                    "legend": {"format": ".1s"}
                                },  
                                "tooltip": [
                                    {"field": "Country", "type": "nominal", "title": "Country"},
                                    {"field": "Region", "type": "nominal"},
                                    {"field": "Score", "type": "quantitative"},
                                    {"field": "Generosity", "type": "quantitative"},
                                    {"field": "Population", "type": "quantitative", "title":"Population in 2020","format": ".1s"}
                                  ]
                            }
                        }
                    ]
                },
                {
                    "width": 400,
                    "height": 400,
                    "title": "Happiness Score and Perceptions of corruption",
                    "transform": [
                        {"filter": "datum.year == year_selection"},
                        {"filter": "Continent_selection == null || datum.Region == Continent_selection"},
                        {"filter": "datum.Perceptions_of_corruption > 0"},
                        {"filter": "datum.Population > Population_Above"}   
                    ],
                    "encoding": {
                        "x": {
                            "field": "Perceptions_of_corruption",
                            "type": "quantitative",
                            "title": "Perceptions of corruption",
                            "scale": {"type": "linear", "domain": [0, 1]}
                        },
                        "y": {
                            "field": "Score",
                            "type": "quantitative",
                            "scale": {"type": "linear", "domain": [2, 8]}
                        }
                    },
                    "layer":[
                        {
                            "mark": "circle",
                            "encoding": {
                                "color": {
                                    "field": "Region",
                                    "type": "nominal",
                                    "scale": {
                                        "domain": [
                                            "North America",
                                            "South America",
                                            "Europe",
                                            "Africa",
                                            "Asia",
                                            "Oceania"
                                            ],
                                        "range": [
                                            "#e41a1c",
                                            "#984ea3",
                                            "#ff7f00",
                                            "#93f5cb",
                                            "#377eb8",
                                            "#a65628"
                                            ]
                                        }
                                },
                                "size": {
                                    "field": "Population",
                                    "type": "quantitative",
                                    "scale": {
                                        "type": "threshold",
                                        "domain": [1000000, 10000000, 50000000, 100000000, 500000000, 1000000000],
                                        "range": [50, 100, 200, 300, 400, 1000, 2000]
                                    },
                                    "legend": {"format": ".1s"}
                                },  
                                "tooltip": [
                                    {"field": "Country", "type": "nominal", "title": "Country"},
                                    {"field": "Region", "type": "nominal"},
                                    {"field": "Score", "type": "quantitative"},
                                    {"field": "Perceptions of corruption", "type": "quantitative"},
                                    {"field": "Population", "type": "quantitative", "title":"Population in 2020","format": ".1s"}
                                  ]
                            }
                        }
                   ],
              }       
            ]
        } 
    ],
    "config": {
        "axis": {
            "grid": false
        },
        "legend": {
        "labelFontSize": 12
      }
    }
}
vegaEmbed("#vis2", spec1, {mode: "vega-lite"}).then(console.log).catch(console.warn);
    </script>
    <br>
    <h2 class = "subTitle">Average data in region</h2>
    <br>
    <br>
    <h3 class = "text"> This line chart shows the change of each region's average happiness score and the other four affect
      factors which has positive related to happinesss score  from
        2007 to 2021, we can see the Oceania region has the highest average happiness score over the 
        time with the other factors score. Click on the legend to highlight a specifc region.
    </h3>
    <br>
   <div class = "center1" id="vis3"> </div>
   <script>
    const spec3 = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {
      "url": "https://raw.githubusercontent.com/weiliang-chen/FIT3179/main/data/world-happiness-report.csv"
    },
    "params": [
      {
        "name": "Region_bind",
        "select": {"type": "point", "fields": ["Region"]},
        "bind": "legend"
      }  
    ],
    "transform": [
        {
            "aggregate": [
              {"op": "average", "field": "Score", "as": "mean_score"},
              {"op": "average", "field": "GDP_per_capita", "as": "mean_gdp"},
              {"op": "average", "field": "Social_support", "as": "mean_social_support"},
              {"op": "average", "field": "Healthy", "as": "mean_healthy"},
              {"op": "average", "field": "Freedom", "as": "mean_freedom"},
              {"op": "average", "field": "Generosity", "as": "mean_generosity"},
              {"op": "average", "field": "Perceptions_of_corruption", "as": "mean_corruption"}
            ],
            "groupby": ["Region", "year"]
        }
    ],
    "vconcat":[
        {
            "title": {"text": "Average Happiness Score in each region"},
            "width": 650,
            "height": 300,
            "encoding": {
                "color": {
                  "field": "Region",
                  "type": "nominal",
                  "scale": {
                    "domain": [
                      "North America",
                      "South America",
                      "Europe",
                      "Africa",
                      "Asia",
                      "Oceania"
                    ],
                    "range": [
                      "#e41a1c",
                      "#984ea3",
                      "#ff7f00",
                      "#93f5cb",
                      "#377eb8",
                      "#a65628"
                    ]
                  },
                  "legend": {"format": ""}
                },
                "opacity": {
                  "condition": {"param": "Region_bind", "value": 1},
                  "value": 0.2
                }
              },
              "layer": [
                {
                  "mark": "line",
                  "encoding": {
                    "x": {
                      "field": "year",
                      "type": "temporal",
                      "timeUnit": "year",
                      "title": "year",
                      "scale": {"type": "linear", "domain": [2007, 2021]}
                    },
                    "y": {
                      "field": "mean_score",
                      "aggregate": "average",
                      "type": "quantitative",
                      "title": "Score",
                      "scale": {"type": "linear", "domain": [3, 8]}
                    },
                    "tooltip": [
                      {"field": "Region", "type": "nominal"},
                      {"field": "mean_score", "type": "quantitative", "title": "Happniness_average", "format": ".2"}
                    ]
                  }
                }
              ]
        },
        {
            "title": {"text": "Average GDP in Capita in each region"},
            "width": 650,
            "height": 300,
            "encoding": {
                "color": {
                  "field": "Region",
                  "type": "nominal",
                  "scale": {
                    "domain": [
                      "North America",
                      "South America",
                      "Europe",
                      "Africa",
                      "Asia",
                      "Oceania"
                    ],
                    "range": [
                      "#e41a1c",
                      "#984ea3",
                      "#ff7f00",
                      "#93f5cb",
                      "#377eb8",
                      "#a65628"
                    ]
                  },
                  "legend": {"format": ""}
                },
                "opacity": {
                  "condition": {"param": "Region_bind", "value": 1},
                  "value": 0.2
                }
              },
              "layer": [
                {
                  "mark": "line",
                  "encoding": {
                    "x": {
                      "field": "year",
                      "type": "temporal",
                      "timeUnit": "year",
                      "title": "year",
                      "scale": {"type": "linear", "domain": [2007, 2021]}
                    },
                    "y": {
                      "field": "mean_gdp",
                      "aggregate": "average",
                      "type": "quantitative",
                      "title": "Score",
                      "scale": {"type": "linear", "domain": [7, 11]}
                    },
                    "tooltip": [
                      {"field": "Region", "type": "nominal"},
                      {"field": "mean_gdp", "type": "quantitative", "title": "GDP_average", "format": ".2"}
                    ]
                  }
                }
              ]
        },
        {
            "title": {"text": "Average Social Support in each region"},
            "width": 650,
            "height": 300,
            "encoding": {
                "color": {
                  "field": "Region",
                  "type": "nominal",
                  "scale": {
                    "domain": [
                      "North America",
                      "South America",
                      "Europe",
                      "Africa",
                      "Asia",
                      "Oceania"
                    ],
                    "range": [
                      "#e41a1c",
                      "#984ea3",
                      "#ff7f00",
                      "#93f5cb",
                      "#377eb8",
                      "#a65628"
                    ]
                  },
                  "legend": {"format": ""}
                },
                "opacity": {
                  "condition": {"param": "Region_bind", "value": 1},
                  "value": 0.2
                }
              },
              "layer": [
                {
                  "mark": "line",
                  "encoding": {
                    "x": {
                      "field": "year",
                      "type": "temporal",
                      "timeUnit": "year",
                      "title": "year",
                      "scale": {"type": "linear", "domain": [2007, 2021]}
                    },
                    "y": {
                      "field": "mean_social_support",
                      "aggregate": "average",
                      "type": "quantitative",
                      "title": "Score",
                      "scale": {"type": "linear", "domain": [0.6, 1.0]}
                    },
                    "tooltip": [
                      {"field": "Region", "type": "nominal"},
                      {"field": "mean_social_support", "type": "quantitative", "title": "Social_average", "format": ".2"}
                    ]
                  }
                }
              ]
        },
        {
            "title": {"text": "Average Healthy life expectancy in each region"},
            "width": 650,
            "height": 300,
            "encoding": {
                "color": {
                  "field": "Region",
                  "type": "nominal",
                  "scale": {
                    "domain": [
                      "North America",
                      "South America",
                      "Europe",
                      "Africa",
                      "Asia",
                      "Oceania"
                    ],
                    "range": [
                      "#e41a1c",
                      "#984ea3",
                      "#ff7f00",
                      "#93f5cb",
                      "#377eb8",
                      "#a65628"
                    ]
                  },
                  "legend": {"format": ""}
                },
                "opacity": {
                  "condition": {"param": "Region_bind", "value": 1},
                  "value": 0.2
                }
              },
              "layer": [
                {
                  "mark": "line",
                  "encoding": {
                    "x": {
                      "field": "year",
                      "type": "temporal",
                      "timeUnit": "year",
                      "title": "year",
                      "scale": {"type": "linear", "domain": [2007, 2021]}
                    },
                    "y": {
                      "field": "mean_healthy",
                      "aggregate": "average",
                      "type": "quantitative",
                      "title": "Score",
                      "scale": {"type": "linear", "domain": [40, 80]}
                    },
                    "tooltip": [
                      {"field": "Region", "type": "nominal"},
                      {"field": "mean_healthy", "type": "quantitative", "title": "healthy_average"}
                    ]
                  }
                }
              ]
        },
        {
            "title": {"text": "Average Freedom Score in each region"},
            "width": 650,
            "height": 300,
            "encoding": {
                "color": {
                  "field": "Region",
                  "type": "nominal",
                  "scale": {
                    "domain": [
                      "North America",
                      "South America",
                      "Europe",
                      "Africa",
                      "Asia",
                      "Oceania"
                    ],
                    "range": [
                      "#e41a1c",
                      "#984ea3",
                      "#ff7f00",
                      "#93f5cb",
                      "#377eb8",
                      "#a65628"
                    ]
                  },
                  "legend": {"format": ""}
                },
                "opacity": {
                  "condition": {"param": "Region_bind", "value": 1},
                  "value": 0.2
                }
              },
              "layer": [
                {
                  "mark": "line",
                  "encoding": {
                    "x": {
                      "field": "year",
                      "type": "temporal",
                      "timeUnit": "year",
                      "title": "year",
                      "scale": {"type": "linear", "domain": [2007, 2021]}
                    },
                    "y": {
                      "field": "mean_freedom",
                      "aggregate": "average",
                      "type": "quantitative",
                      "title": "Score",
                      "scale": {"type": "linear", "domain": [0.5, 1.0]}
                    },
                    "tooltip": [
                      {"field": "Region", "type": "nominal"},
                      {"field": "mean_freedom", "type": "quantitative", "title": "freedom_average", "format": ".2"}
                    ]
                  }
                }
              ]
        }
    ],
    "config": {
        "legend": {
          "labelFontSize": 12
        }
    }
}
    vegaEmbed("#vis3", spec3, {mode: "vega-lite"}).then(console.log).catch(console.warn);
    </script>
  </div>
</body>
</html>